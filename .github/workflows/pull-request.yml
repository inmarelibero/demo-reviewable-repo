# Create a PR when a feature/* branch is pushed
#
# @dev if the pushed branch is already involved in an existing PR, a new PR will not be created

name: Pull Request on Branch Push
on:
  push:
    branches: 'feature/*'

permissions:
  contents: read
  pull-requests: write

jobs:
  auto-pull-request:
    name: PullRequestAction
    runs-on: ubuntu-latest
    steps:
      - name: Create pull request
        uses: actions/github-script@v7
        with:
          script: |
            const branch = context.ref.replace('refs/heads/', '');
            const base = 'dev';

            // Check if PR already exists
            const { data: pulls } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              head: `${context.repo.owner}:${branch}`,
              base: base
            });

            if (pulls.length > 0) {
              console.log(`PR already exists: ${pulls[0].html_url}`);
              return;
            }

            // Create PR
            const { data: pr } = await github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `Update from ${branch}`,
              body: `This is an automated pull request to update from branch ${branch}`,
              head: branch,
              base: base
            });

            console.log(`Created PR: ${pr.html_url}`);
